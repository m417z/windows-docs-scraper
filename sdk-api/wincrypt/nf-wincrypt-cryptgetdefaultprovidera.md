# CryptGetDefaultProviderA function

## Description

**Important** This API is deprecated. New and existing software should start using [Cryptography Next Generation APIs.](https://learn.microsoft.com/windows/desktop/SecCNG/cng-portal) Microsoft may remove this API in future releases.

The **CryptGetDefaultProvider** function finds the default [cryptographic service provider](https://learn.microsoft.com/windows/desktop/SecGloss/c-gly) (CSP) of a specified provider type for the local computer or current user. The name of the default CSP for the provider type specified in the *dwProvType* parameter is returned in the *pszProvName* buffer.

## Parameters

### `dwProvType` [in]

The provider type for which the default CSP name is to be found.

Defined provider types are as follows:

* [PROV_RSA_FULL](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-rsa-full)
* [PROV_RSA_SIG](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-rsa-sig)
* [PROV_DSS](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-dss)
* [PROV_DSS_DH](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-dss-dh)
* [PROV_DH_SCHANNEL](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-dh-schannel)
* [PROV_FORTEZZA](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-fortezza)
* [PROV_MS_EXCHANGE](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-ms-exchange)
* [PROV_RSA_SCHANNEL](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-rsa-schannel)
* [PROV_SSL](https://learn.microsoft.com/windows/desktop/SecCrypto/prov-ssl)

### `pdwReserved` [in]

This parameter is reserved for future use and must be **NULL**.

### `dwFlags` [in]

The following flag values are defined.

| Value | Meaning |
| --- | --- |
| **CRYPT_USER_DEFAULT**<br><br>0x00000002 | Returns the user-context default CSP of the specified type. |
| **CRYPT_MACHINE_DEFAULT**<br><br>0x00000001 | Returns the computer default CSP of the specified type. |

### `pszProvName` [out]

A pointer to a null-terminated character string buffer to receive the name of the default CSP.

To find the size of the buffer for memory allocation purposes, this parameter can be **NULL**. For more information, see
[Retrieving Data of Unknown Length](https://learn.microsoft.com/windows/desktop/SecCrypto/retrieving-data-of-unknown-length).

### `pcbProvName` [in, out]

A pointer to a **DWORD** value that specifies the size, in bytes, of the buffer pointed to by the *pszProvName* parameter. When the function returns, the **DWORD** value contains the number of bytes stored or to be stored in the buffer.

**Note** When processing the data returned in the buffer, applications must use the actual size of the data returned. The actual size can be slightly smaller than the size of the buffer specified on input. (On input, buffer sizes are usually specified large enough to ensure that the largest possible output data fits in the buffer.) On output, the variable pointed to by this parameter is updated to reflect the actual size of the data copied to the buffer.

## Return value

If the function succeeds, the return value is nonzero (**TRUE**).

If the function fails, the return value is zero (**FALSE**). For extended error information, call
[GetLastError](https://learn.microsoft.com/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).

The error code prefaced by NTE is generated by the particular CSP being used. Possible error codes include the following.

| Return code | Description |
| --- | --- |
| **ERROR_INVALID_PARAMETER** | One of the parameters contains a value that is not valid. This is most often a pointer that is not valid. |
| **ERROR_MORE_DATA** | The buffer for the name is not large enough. |
| **ERROR_NOT_ENOUGH_MEMORY** | The operating system ran out of memory. |
| **NTE_BAD_FLAGS** | The *dwFlags* parameter has an unrecognized value. |

## Remarks

This function determines which installed CSP is currently set as the default for the local computer or current user. This information is often displayed to the user.

#### Examples

The following example retrieves the name of the default CSP for the PROV_RSA_FULL provider type. For another example that uses this function, see [Example C Program: Enumerating CSP Providers and Provider Types](https://learn.microsoft.com/windows/desktop/SecCrypto/example-c-program-enumerating-csp-providers-and-provider-types).

```cpp
#include <stdio.h>
#include <windows.h>
#include <Wincrypt.h>
#pragma comment(lib, "crypt32.lib")

void main()
{

    DWORD       cbProvName=0;
    LPTSTR      pbProvName=NULL;
    // Copyright (C) Microsoft.  All rights reserved.
    // Get the length of the RSA_FULL default provider name.
    if (!(CryptGetDefaultProvider(
         PROV_RSA_FULL,
         NULL,
         CRYPT_MACHINE_DEFAULT,
         NULL,
         &cbProvName)))
    {
      printf("Error getting the length of the default "
          "provider name.\n");
      exit(1);
    }

    // Allocate local memory for the name of the default provider.
    if (!(pbProvName = (LPTSTR)LocalAlloc(LMEM_ZEROINIT,
        cbProvName)))
    {
        printf("Error during memory allocation for "
            "provider name.\n");
        exit(1);
    }

    // Get the default provider name.
    if (CryptGetDefaultProvider(
        PROV_RSA_FULL,
        NULL,
        CRYPT_MACHINE_DEFAULT,
        pbProvName,
        &cbProvName))
    {
        printf("The default provider name is %s\n",pbProvName);
    }
    else
    {
        printf("Getting the name of the provider failed.\n");
        exit(1);
    }

    // Free resources when done.
    LocalFree(pbProvName);

}

```

> [!NOTE]
> The wincrypt.h header defines CryptGetDefaultProvider as an alias that automatically selects the ANSI or Unicode version of this function based on the definition of the UNICODE preprocessor constant. Mixing usage of the encoding-neutral alias with code that is not encoding-neutral can lead to mismatches that result in compilation or runtime errors. For more information, see [Conventions for Function Prototypes](https://learn.microsoft.com/windows/win32/intl/conventions-for-function-prototypes).

## See also

[CryptSetProvider](https://learn.microsoft.com/windows/desktop/api/wincrypt/nf-wincrypt-cryptsetprovidera)

[CryptSetProviderEx](https://learn.microsoft.com/windows/desktop/api/wincrypt/nf-wincrypt-cryptsetproviderexa)

[Service Provider Functions](https://learn.microsoft.com/windows/desktop/SecCrypto/cryptography-functions)