# CVssWriterEx::OnIdentifyEx

## Description

Returns a pointer to an
[IVssCreateWriterMetadataEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadataex) object.

**OnIdentifyEx** is a virtual method. It is implemented by the
[CVssWriterEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-cvsswriterex) base class, but can be overridden by derived classes.

## Parameters

### `pMetadata` [in]

A pointer to an
[IVssCreateWriterMetadataEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadataex) object.

## Return value

As implemented by the base class,
**OnIdentifyEx** always returns **true**.

Any other implementation of this method must return **true** except in the case of a fatal error.
If a fatal error occurs, the method should return **false**.

 In all cases when a failure occurs, including nonfatal errors, the method should write a detailed entry to the event log to report the exact reason for the failure.

## Remarks

The **OnIdentifyEx** method is identical to the [OnIdentify](https://learn.microsoft.com/windows/desktop/api/vswriter/nf-vswriter-cvsswriter-onidentify) method, except that it returns an [IVssCreateWriterMetadataEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadataex) interface pointer instead of an [IVssCreateWriterMetadata](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadata) interface pointer in the *pMetadata* parameter. A writer can override **OnIdentify** or **OnIdentifyEx**, but not both.

Writers should never throw an exception from this method or any other **CVssWriter(Ex)::On*Xxx*** callback method.

Writers should never call the [CVssWriter::SetWriterFailure](https://learn.microsoft.com/windows/desktop/api/vswriter/nf-vswriter-cvsswriter-setwriterfailure) method from the [OnIdentify](https://learn.microsoft.com/windows/desktop/api/vswriter/nf-vswriter-cvsswriter-onidentify) or **OnIdentifyEx** method.

If this method calls the [CVssWriterEx2::GetSessionId](https://learn.microsoft.com/windows/desktop/api/vswriter/nf-vswriter-cvsswriterex2-getsessionid) method, it must do so in the same thread that called this method. For more information, see
[Writer Event Handling](https://learn.microsoft.com/windows/desktop/VSS/writers).

In response to an [Identify](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-i) event that is generated by another application, a writer calls **OnIdentifyEx** to create a [Writer Metadata Document](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-w) that contains information about the components it manages using the
[IVssCreateWriterMetadataEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadata) interface.

The application that generated the [Identify](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-i) event then retrieves the [Writer Metadata Document](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-w) and examines the writer's component information using the
[IVssExamineWriterMetadata](https://learn.microsoft.com/windows/desktop/api/vsbackup/nl-vsbackup-ivssexaminewritermetadata) interface.

An [Identify](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-i) event is required before the events that make up a backup or restore sequence. Therefore, **OnIdentifyEx** is typically called to handle an *Identify* event in response to a requester's call to
[IVssBackupComponents::GatherWriterMetadata](https://learn.microsoft.com/windows/desktop/api/vsbackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) as part of a backup or restore operation.

However, an [Identify](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-i) event by itself is not part of the sequence of events that make up a backup or restore sequence, and the VSS service does not prevent *Identify* events from being generated, even while a backup or restore sequence is in progress. For example, VSS management applications use the *Identify* event to determine and display the state of the writers on the system.

For this reason, writers should never use their implementation of **OnIdentifyEx** in any of the following ways:

* As the beginning of their handling of a backup or restore sequence
* To set or maintain information about the writer's state

For more information about writer interactions with events, see
[Writer Event Handling](https://learn.microsoft.com/windows/desktop/VSS/writers).

 During the [PrepareForBackup](https://learn.microsoft.com/windows/desktop/api/vsbackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [PrepareForSnapshot](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-p), and [PostSnapshot](https://learn.microsoft.com/windows/desktop/VSS/vssgloss-p) events, a writer can use the [GetIdentifyInformation](https://learn.microsoft.com/windows/desktop/api/vswriter/nf-vswriter-cvsswriterex-getidentifyinformation) method to get the metadata that the writer's **OnIdentifyEx** method previously reported.

The life cycle of the
[IVssCreateWriterMetadataEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadataex) object that the *pMetadata* parameter points to is managed by the VSS infrastructure.

## See also

[CVssWriterEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-cvsswriterex)

[CVssWriterEx::GetIdentifyInformation](https://learn.microsoft.com/windows/desktop/api/vswriter/nf-vswriter-cvsswriterex-getidentifyinformation)

[IVssCreateWriterMetadataEx](https://learn.microsoft.com/windows/desktop/api/vswriter/nl-vswriter-ivsscreatewritermetadataex)