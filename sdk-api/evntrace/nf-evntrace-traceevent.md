# TraceEvent function

## Description

A
[RegisterTraceGuids](https://learn.microsoft.com/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa)-based
("Classic") event provider uses the **TraceEvent** function to send a structured
event to an event tracing session.

## Parameters

### `TraceHandle` [in]

Handle to the event tracing session that records the event. The provider obtains
the handle when it calls the
[GetTraceLoggerHandle](https://learn.microsoft.com/windows/desktop/ETW/gettraceloggerhandle) function in
its [ControlCallback](https://learn.microsoft.com/windows/desktop/ETW/controlcallback) implementation.

### `EventTrace` [in]

Pointer to an [EVENT_TRACE_HEADER](https://learn.microsoft.com/windows/desktop/ETW/event-trace-header)
structure. Event-specific data is optionally appended to the structure. The
largest event you can log is slightly less than 64K. You must specify values for
the following members of the **EVENT_TRACE_HEADER** structure.

- **Size**
- **Guid** or **GuidPtr**
- **Flags**

Depending on the complexity of the information your provider provides, you
should also consider specifying values for the following members.

- **Class.Type**
- **Class.Level**

## Return value

If the function succeeds, the return value is ERROR_SUCCESS.

If the function fails, the return value is one of the
[system error codes](https://learn.microsoft.com/windows/win32/debug/system-error-codes). The following
are some common errors and their causes.

- **ERROR_INVALID_FLAG_NUMBER**

 The **Flags** member of the
[EVENT_TRACE_HEADER](https://learn.microsoft.com/windows/desktop/ETW/event-trace-header) structure is
incorrect.

- **ERROR_INVALID_HANDLE**

 _TraceHandle_ is not valid or specifies the NT Kernel Logger session handle.

- **ERROR_NOT_ENOUGH_MEMORY**

 The session ran out of free buffers to write to. This can occur during high
event rates because the disk subsystem is overloaded or the number of buffers
is too small. Rather than blocking until more buffers become available,
[TraceEvent](https://learn.microsoft.com/windows/desktop/ETW/traceevent) discards the event.

 Consider increasing the number and size of the buffers for the session, or
reducing the number of events written or the size of the events.

  **Windows 2000:** Not supported.

- **ERROR_OUTOFMEMORY**

 The event is discarded because, although the buffer pool has not reached its
maximum size, there is insufficient available memory to allocate an additional
buffer and there is no buffer available to receive the event.

- **ERROR_INVALID_PARAMETER**

 One of the following is true:

  - _TraceHandle_ is **NULL**.
  - _EventTrace_ is **NULL**.
  - The **Size** member of the
[EVENT_TRACE_HEADER](https://learn.microsoft.com/windows/desktop/ETW/event-trace-header) structure is
incorrect.

- **ERROR_MORE_DATA**

 Data from a single event cannot span multiple buffers. A trace event is
limited to the size of the event tracing session's buffer minus the size of
the [EVENT_TRACE_HEADER](https://learn.microsoft.com/windows/desktop/ETW/event-trace-header) structure.

## Remarks

MOF-based ETW providers call this function.

> [!Note]
> Most developers will not call this function. This API supports
> MOF-based ETW, but MOF-based ETW is deprecated in favor of manifest-based ETW.
> In addition, most MOF-based providers use wrapper functions generated by
> MC.exe instead of directly calling ETW APIs.

Before the provider can call this function, the provider

- Must call the
[RegisterTraceGuids](https://learn.microsoft.com/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa)
function to register itself and the event trace class.
- Must be enabled. A controller calls the
[EnableTrace](https://learn.microsoft.com/windows/desktop/ETW/enabletrace) function to enable a provider.

The event is either written to a log file, sent to event trace consumers in real
time, or both. The **LogFileMode** member of the
[EVENT_TRACE_PROPERTIES](https://learn.microsoft.com/windows/desktop/ETW/event-trace-properties) structure
passed to the [StartTrace](https://learn.microsoft.com/windows/desktop/ETW/starttrace) defines where the
event is sent.

The trace events are written in the order in which they occur.

To trace a set of related events, use the
[TraceEventInstance](https://learn.microsoft.com/windows/desktop/ETW/traceeventinstance) function.

On Windows Vista, you should use the
[EventWrite](https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventwrite) function to
log events.

### Examples

For an example that uses **TraceEvent**, see
[Tracing Events](https://learn.microsoft.com/windows/desktop/ETW/tracing-events).

## See also

[EVENT_TRACE_HEADER](https://learn.microsoft.com/windows/desktop/ETW/event-trace-header)

[EnableTrace](https://learn.microsoft.com/windows/desktop/ETW/enabletrace)

[RegisterTraceGuids](https://learn.microsoft.com/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa)

[TraceEventInstance](https://learn.microsoft.com/windows/desktop/ETW/traceeventinstance)